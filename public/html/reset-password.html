<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Redefinir senha</title>
  <link rel="shortcut icon" href="https://i.imgur.com/ektkb6r.png" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/auth.css"/>
</head>
<body>
    <header>
        <img src="../assets/logo.png" alt="Balcão & Bandeja" />
    </header>

  <main>
      <div class="auth-card">
        <h1>Redefinir senha</h1>
        <form id="resetForm">
          <label>Nova senha</label>
          <input id="pwd" type="password" minlength="8" required placeholder="********"/>
          <label>Confirmar senha</label>
          <input id="pwd2" type="password" minlength="8" required placeholder="********"/>
          <button type="submit">Salvar nova senha</button>
        </form>
        <p id="msg" class="muted"></p>
      </div>
  </main>

    <footer>
      © 2025 Balcão & Bandeja — Todos os direitos reservados.
    </footer>

  <script>
    const params = new URLSearchParams(location.search);
    const token = params.get("token");

    document.getElementById("resetForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const p = document.getElementById("pwd").value;
      const p2 = document.getElementById("pwd2").value;
      if (p !== p2) { document.getElementById("msg").textContent = "As senhas não coincidem."; return; }
      document.getElementById("msg").textContent = "Atualizando senha...";
      try {
        await fetch("/api/auth/reset", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token, newPassword: p })
        });
        // Mensagem genérica sempre
        document.getElementById("msg").textContent = "Senha atualizada. Redirecionando...";
        setTimeout(()=> location.href = "/login", 1500);
      } catch {
        document.getElementById("msg").textContent = "Senha atualizada. Redirecionando...";
        setTimeout(()=> location.href = "/login", 1500);
      }
    });
  </script>
</body>
</html>